To understand the impact of age and AHI on spindle count, we’ll model two questions:

Question 1: Does AHI predict spindle count, and how does its impact compare to that of age, given age's known developmental effect on count?
Question 2: Does AHI change the relationship between age and spindle count — i.e., does AHI disrupt normal spindle development?

Before starting, I suggest you log AHI using log1p(AHI), i.e., log(AHI + 1))
Because
•	Many children have low AHI (close to 1), and a few have much higher values (10–30+).
•	This violates assumptions of linearity and homoscedasticity in regression models.

2. The relationship may not be linear:
•	The effect of AHI may level off at higher levels.
•	AHI = 5 vs. AHI = 10 might not differ as much in impact as AHI = 1 vs. AHI = 5.

3. Interpretation improves:
•	Log(AHI) changes the scale from raw count of apneas/hypopneas per hour to relative increases (multiplicative impact).
•	It helps stabilize variance and makes betas more interpretable.


In R
df$log_AHI <- log1p(df$AHI)  # safer than log(AHI) since some kids may have AHI close to 0
log1p(AHI)


Summary of modeling steps 
Step	Purpose
Model: Spindle ~ Age + AHI + Covariates	Baseline comparison
Standardize predictors	Make βs comparable
Use partial R²	Quantify relative importance
Visualize residuals	Understand unique AHI effects
Repeat by region	Frontal vs. Parietal comparison

Question 1: Does AHI predict spindle count, and how does its impact compare to that of age, given age's known developmental effect on count?

Spindle_Count ~ Age + AHI + Covariates
Where:
•	Spindle_Count = outcome (either frontal or parietal, analyzed separately)
•	Age = continuous predictor
•	AHI = continuous predictor (disorder severity)
•	Covariates = sex
model <- lm(frontal_spindle_count ~ age + AHI + sex , data = df)
summary(model)

Estimating the main effect of age on spindle count.
Estimating the main effect of AHI on spindle count.
 Including both together lets you see whether AHI explains additional variance in spindle count above and beyond age.
If you standardize age and AHI, you can compare the magnitude of their effects.

Interpretation of outcome
•	Significant Age term: expected; spindle count increases with age.
•	Significant AHI term: indicates that disorder severity contributes additional explanatory power beyond age.
•	Standardized beta coefficients (β) or partial R² for each predictor will tell you which variable has the stronger effect.
How to Compare Impact: Age vs. AHI
 A. Standardize predictors (in R):

df$z_age <- scale(df$age)
df$z_AHI <- scale(df$AHI)

model_z <- lm(frontal_spindle_count ~ z_age + z_AHI + sex, data = df)
summary(model_z)

•  Now the β coefficients are directly comparable.
•  If β_age = 0.50 and β_AHI = -0.30, then age has a stronger (positive) influence, but AHI still has a meaningful (negative) one.
B. Compare partial R² for each predictor (This tells you what % of the model’s variance is explained by each predictor.)
Use the relaimpo package in R:
library(relaimpo)
calc.relimp(model_z, type = "lmg", rela = TRUE)


C. Visualize the relationships
A. Spindle vs. AHI (controlling for age):

library(ggplot2)

ggplot(df, aes(x = AHI, y = frontal_spindle_count)) +
  geom_point() +
  geom_smooth(method = "lm") +
  facet_wrap(~ cut(df$age, breaks = 3)) +  # to visualize AHI effects across age bands
  theme_minimal()

B. Residual plot:
Regress out age and plot residual spindle count vs. AHI:
resid_age <- resid(lm(frontal_spindle_count ~ age + sex + total_NREM, data = df))
ggplot(df, aes(x = AHI, y = resid_age)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Effect of AHI on Spindle Count Residual (after age)")
Question 2: Does AHI change the relationship between age and spindle count — i.e., does AHI disrupt normal spindle development?

model <- lm(spindle_count ~ age * AHI + sex, data = df)
summary(model)
•	age * AHI expands to: age + AHI + age:AHI
•	The age:AHI term tells you if AHI changes the slope of age on spindle count.
Interpret Coefficients
In the output:
•	age = effect of age on spindle count when AHI = 0
•	AHI = effect of AHI on spindle count when age = 0
•	age:AHI = moderation effect: does AHI alter the age-spindle relationship?

If age:AHI is significant:
•	AHI alters the developmental trajectory of spindle accumulation.

Step 2: Standardize Predictors

To compare effects and help visualization:
df$z_age <- scale(df$age)
df$z_AHI <- scale(df$AHI)

model_z <- lm(spindle_count ~ z_age * z_AHI + sex, data = df)
summary(model_z)

Visualize the Interaction
Using interactions package

library(interactions)

interact_plot(model_z, pred = z_age, modx = z_AHI,
              plot.points = TRUE, 
              modx.values = c(-1, 0, 1), # mean and ±1 SD
              x.label = "Age (z-score)",
              y.label = "Spindle Count",
              main.title = "Interaction of Age and AHI on Spindle Count")

This shows age–spindle relationship at low, mean, and high AHI.

“Do children with more severe sleep disordered breathing fail to show the normal age-related increase in spindle count?”

If you find:
•	A significant negative interaction (age:AHI): the slope of spindle count vs. age flattens or reverses at higher AHI levels.
•	That’s evidence of disrupted developmental trajectory due to SDB.

